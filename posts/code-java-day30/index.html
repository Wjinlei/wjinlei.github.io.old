<!DOCTYPE html>
<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/custom-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/all.css">
    
    
    <title>Java Springboot</title>
</head>
<body class="container"><div id="fastSearch">
  <input id="searchInput" tabindex="0">
  <ul id="searchResults"></ul>
</div>

<div style="margin: 40px; display: flex; justify-content: space-between; align-items: end;">
  <div>
  
  
  <h2>Jerry&#39;s Blog</h2>
  <span class="color-999 font-size-14">珍爱生命，远离卷王，拒绝内卷，从我做起。温馨提示: 按 Alt&#43;/ 可以搜索哦 ^_^</span>
  </div>
</div>


<div id="nav-border" style="margin: 30px 0px 30px 0px;">
  <ul class="nav nav-tabs" style="justify-content: space-between">
    <div class="nav" style="padding: 0px;">
    
    <li class="nav-item">
      <a class="nav-link active" href="/">
      
      
      <i class="fa-solid fa-house"></i>
      
      
      首页
      </a>
    </li>
    
    <li class="nav-item">
      <a class="nav-link active" href="/posts/">
      
      
      <i class="fa-solid fa-pen-nib"></i>
      
      
      文章
      </a>
    </li>
    
    </div>

    <div class="d-none d-lg-block d-xl-block d-xxl-block">
      <div class="nav" style="padding: 0px;">
      
      <li class="nav-item">
        <a class="nav-link active" href="#">
        
        
        <i class="fa-brands fa-qq"></i>
        
        
        1976883731
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link active" href="#">
        
        
        <i class="fa-brands fa-weixin"></i>
        
        
        JerryWang1996
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link active" href="https://github.com/Wjinlei">
        
        
        <i class="fa-brands fa-github"></i>
        
        
        Wjinlei
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link active" href="mailto:freebufer.wang@gmail.com">
        
        
        <i class="fa-solid fa-envelope"></i>
        
        
        freebufer.wang@gmail.com
        </a>
      </li>
      
      </div>
    </div>
  </ul>
</div>

<style>
 #fastSearch {
    visibility: hidden;
    display: inline-block;
    position: absolute;
    padding: 0;
    width: 320px;
    right: 10px;
    top: 10px;
  }

  #fastSearch input {
    outline: none;
    text-align: left;
    display: inline-block;
    color: #222129;
    background-color: #EEE;
    border: 2px solid #444;
    padding: 4px;
    width: 100%;
    height: 31px;
  }

  #searchResults li {
    list-style: none;
    background-color: #fafede;
    border-bottom: 1px dotted #000;
  }

  #searchResults li .title {
    display: inline-block;
    margin: 0;
  }

  #searchResults {
    visibility: inherit;
    display: inline-block;
    overflow: hidden;
    width: 320px;
    max-height: calc(100vh - 120px);
    padding: 0;
    margin: 0;
  }

  #searchResults a {
    text-decoration: none !important;
    padding: 2px;
    display: inline-block;
    width: 100%;
  }

  #searchResults a:hover, #searchResults a:focus {
    outline: 0;
    background-color: #666;
    color: #fff;
  }
</style>
<div id="content">
<div>
<h4>Java Springboot</h4>
<span class="color-999 font-size-14"><i class="fa-solid fa-eye"></i></i><span id="busuanzi_value_page_pv"></span>次阅读</span>
<span class="font-size-14 color-999">本文共 952 字，阅读约 5 分钟</span>


<div class="color-999 font-size-14">
<time datetime="2021-11-24">2021-11-24 19:36:28</time>

<i class="fa-solid fa-tags"></i>


<a href="http://wjinlei.github.io/tags/java">java</a>


<a href="http://wjinlei.github.io/tags/spring">Spring</a>


<a href="http://wjinlei.github.io/tags/springboot">Springboot</a>


</div>


<div class="font-size-14 color-warning"><i class="fa-solid fa-circle-exclamation"></i>温馨提示: 本文章发布于 2021-11-24 文中内容可能已过时，请注意甄别。</div>

<br>
<h2 id="springboot-security">Springboot-security</h2>
<ul>
<li>Springboot-security(鉴权模块)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>spring-boot-starter-security<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ul>
<li>Add <code>WebSecurityConfig</code></li>
</ul>
<p>默认情况下,<code>springboot-security</code>是拦截所有请求的<br>
因此我们需要配置让它放行我们需要的请求路径</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@EnableWebSecurity
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">WebSecurityConfig</span> <span style="color:#8be9fd;font-style:italic">extends</span> WebSecurityConfigurerAdapter <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">configure</span><span style="color:#ff79c6">(</span>HttpSecurity http<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        http<span style="color:#ff79c6">.</span><span style="color:#50fa7b">csrf</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">disable</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        http<span style="color:#ff79c6">.</span><span style="color:#50fa7b">authorizeRequests</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">antMatchers</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/auth/**&#34;</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">permitAll</span><span style="color:#ff79c6">();</span> <span style="color:#6272a4">// 对根路径和所有/auth路径都放行
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h3 id="鉴权">鉴权</h3>
<ul>
<li>在<code>@Configuration</code>中声明两个<code>Bean</code>,这两个<code>Bean</code>是鉴权的关键,一个用于鉴定权限,一个用于加密密码</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@EnableWebSecurity
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">WebSecurityConfig</span> <span style="color:#8be9fd;font-style:italic">extends</span> WebSecurityConfigurerAdapter <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">configure</span><span style="color:#ff79c6">(</span>HttpSecurity http<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        http<span style="color:#ff79c6">.</span><span style="color:#50fa7b">csrf</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">disable</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        http<span style="color:#ff79c6">.</span><span style="color:#50fa7b">authorizeRequests</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">antMatchers</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;/auth/**&#34;</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">permitAll</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 鉴权管理器 */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> AuthenticationManager <span style="color:#50fa7b">customAuthenticationManager</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> authenticationManager<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 加密器 */</span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> BCryptPasswordEncoder <span style="color:#50fa7b">bCryptPasswordEncoder</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> BCryptPasswordEncoder<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><ul>
<li>Service</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UserService</span> <span style="color:#8be9fd;font-style:italic">implements</span> UserDetailsService <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> UserMapper userMapper<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> BCryptPasswordEncoder bCryptPasswordEncoder<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">,</span> String password<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> userMapper<span style="color:#ff79c6">.</span><span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">,</span> bCryptPasswordEncoder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">encode</span><span style="color:#ff79c6">(</span>password<span style="color:#ff79c6">));</span> <span style="color:#6272a4">// 加密存储密码
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> User <span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> userMapper<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 覆盖loadUserByUsername方法,查询对应用户是否存在,并返回用户的详细信息 */</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> UserDetails <span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> UsernameNotFoundException <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#ff79c6">=</span> selectUserByUsername<span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>user <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> UsernameNotFoundException<span style="color:#ff79c6">(</span>username <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; 不存在!&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">security</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">core</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">userdetails</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">User</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">withUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">password</span><span style="color:#ff79c6">(</span>user<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getPassword</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">authorities</span><span style="color:#ff79c6">(</span>Collections<span style="color:#ff79c6">.</span><span style="color:#50fa7b">emptyList</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><ul>
<li>Controller</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UserController</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> UserService userService<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> AuthenticationManager authenticationManager<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @PostMapping<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth/login&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">login</span><span style="color:#ff79c6">(</span>@RequestBody Map<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">,</span> String<span style="color:#ff79c6">&gt;</span> body<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        String username <span style="color:#ff79c6">=</span> body<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;username&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        String password <span style="color:#ff79c6">=</span> body<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        UserDetails userDetails<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            userDetails <span style="color:#ff79c6">=</span> userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 获取用户详细信息 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>UsernameNotFoundException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fail</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户不存在&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        UsernamePasswordAuthenticationToken token <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">new</span> UsernamePasswordAuthenticationToken<span style="color:#ff79c6">(</span>
</span></span><span style="display:flex;"><span>                        userDetails<span style="color:#ff79c6">,</span> password<span style="color:#ff79c6">,</span> userDetails<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getAuthorities</span><span style="color:#ff79c6">());</span> <span style="color:#6272a4">/* 根据用户详细信息创建token(令牌)对象,它保存了用户信息 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            authenticationManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">authenticate</span><span style="color:#ff79c6">(</span>token<span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 验证令牌 */</span>
</span></span><span style="display:flex;"><span>            SecurityContextHolder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getContext</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">setAuthentication</span><span style="color:#ff79c6">(</span>token<span style="color:#ff79c6">);</span> <span style="color:#6272a4">// 将信息保存到Session中
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">}</span> <span style="color:#ff79c6">catch</span> <span style="color:#ff79c6">(</span>BadCredentialsException e<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fail</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;密码错误&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ok</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;登录成功&#34;</span><span style="color:#ff79c6">,</span> userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">),</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h3 id="状态保持">状态保持</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> Result <span style="color:#50fa7b">auth</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 我把这个 Authentication 就看作 Session 对象 */</span>
</span></span><span style="display:flex;"><span>    Authentication session <span style="color:#ff79c6">=</span> SecurityContextHolder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getContext</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getAuthentication</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    User user <span style="color:#ff79c6">=</span> userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>session <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">?</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">:</span> session<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getName</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>user <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fail</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户尚未登录!&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ok</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户已登录&#34;</span><span style="color:#ff79c6">,</span> user<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h3 id="注销登录清除上下文对象">注销登录(清除上下文对象)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@GetMapping<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth/logout&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 如果已经执行过clearContext,那么这里会是Null */</span>
</span></span><span style="display:flex;"><span>    Authentication session <span style="color:#ff79c6">=</span> SecurityContextHolder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getContext</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getAuthentication</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>session <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">fail</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户尚未登录&#34;</span><span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 因此这里需要避免一下空指针异常 */</span>
</span></span><span style="display:flex;"><span>    SecurityContextHolder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">clearContext</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">ok</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;注销成功&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h2 id="自动化测试与持续集成">自动化测试与持续集成</h2>
<h3 id="自动化测试的好处">自动化测试的好处</h3>
<ul>
<li>自动化</li>
<li>节省你的时间</li>
<li>避免犯错(是人都会犯错)</li>
<li>测试可以反映一个人的水平</li>
</ul>
<h3 id="编写单元测试">编写单元测试</h3>
<h4 id="junit-5">Junit 5</h4>
<ul>
<li>Junit 是一套测试框架</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- 依赖 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;groupId&gt;</span>org.junit.jupiter<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>junit-jupiter<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>5.8.1<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;scope&gt;</span>test<span style="color:#ff79c6">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- 用于单元测试 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-surefire-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- 用于集成测试 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-failsafe-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span></code></pre></div><h4 id="冒烟测试">冒烟测试</h4>
<ul>
<li>什么是冒烟测试?</li>
</ul>
<p>程序创建好后的第一次测试,主要用于测试一下程序能否正常编译</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SmokeTest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">test</span><span style="color:#ff79c6">(){</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h4 id="mock">Mock</h4>
<ul>
<li>什么是Mock</li>
</ul>
<p>我们的对象都会有一些依赖,但我们编写测试的时候不方便或无法获得那些依赖,因此就需要一些<code>假的数据</code><br>
<code>Mock</code>就是假的依赖的对象,例如我们的<code>UserService</code>依赖<code>UserDao</code>,那么我们可以创建一个<code>MockDao</code>来模拟<code>UserDao</code><br>
所谓<code>Mock</code>就是创建一个假的服务,这就是<code>Mock</code>的概念</p>
<h4 id="mockito">Mockito</h4>
<ul>
<li>Mockito是一套Mock框架</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- https://mvnrepository.com/artifact/org.mockito/mockito-junit-jupiter --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;groupId&gt;</span>org.mockito<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>mockito-junit-jupiter<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>4.1.0<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;scope&gt;</span>test<span style="color:#ff79c6">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><h5 id="使用mockito编写单元测试">使用Mockito编写单元测试</h5>
<ul>
<li>例如我们要对这个Service构建单元测试</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UserService</span> <span style="color:#8be9fd;font-style:italic">implements</span> UserDetailsService <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> UserMapper userMapper<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Autowired
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> BCryptPasswordEncoder bCryptPasswordEncoder<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">,</span> String password<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> userMapper<span style="color:#ff79c6">.</span><span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">,</span> bCryptPasswordEncoder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">encode</span><span style="color:#ff79c6">(</span>password<span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> User <span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> userMapper<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 覆盖loadUserByUsername方法,返回对应用户的详细信息 */</span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> UserDetails <span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span>String username<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">throws</span> UsernameNotFoundException <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        User user <span style="color:#ff79c6">=</span> selectUserByUsername<span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>user <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> UsernameNotFoundException<span style="color:#ff79c6">(</span>username <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; 不存在!&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">springframework</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">security</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">core</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">userdetails</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">User</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">withUsername</span><span style="color:#ff79c6">(</span>username<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">password</span><span style="color:#ff79c6">(</span>user<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getPassword</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">authorities</span><span style="color:#ff79c6">(</span>Collections<span style="color:#ff79c6">.</span><span style="color:#50fa7b">emptyList</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><ul>
<li>Test</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@ExtendWith<span style="color:#ff79c6">(</span>MockitoExtension<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span> <span style="color:#6272a4">/* 为这个测试启用Mockito扩展 */</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UserServiceTest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Mock
</span></span><span style="display:flex;"><span>    BCryptPasswordEncoder mockBCryptPasswordEncoder<span style="color:#ff79c6">;</span> <span style="color:#6272a4">/* 假的BCryptPasswordEncoder */</span>
</span></span><span style="display:flex;"><span>    @Mock
</span></span><span style="display:flex;"><span>    UserMapper mockUserMapper<span style="color:#ff79c6">;</span> <span style="color:#6272a4">/* 假的UserMapper */</span>
</span></span><span style="display:flex;"><span>    @InjectMocks
</span></span><span style="display:flex;"><span>    UserService userService<span style="color:#ff79c6">;</span> <span style="color:#6272a4">/* 真实的UserService,并为他注入上面的Mock依赖 */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testRegisterUser</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 当mockBCryptPasswordEncoder.encode(&#34;plaintext&#34;)的时候,让它返回&#34;ciphertext&#34;,模拟加密过程 */</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">when</span><span style="color:#ff79c6">(</span>mockBCryptPasswordEncoder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">encode</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;plaintext&#34;</span><span style="color:#ff79c6">)).</span><span style="color:#50fa7b">thenReturn</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;ciphertext&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;plaintext&#34;</span><span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 测试这个方法 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 我希望调用registerUser的时候,传递给mockUserMapper的值是&#34;test&#34;和&#34;ciphertext&#34; */</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">verify</span><span style="color:#ff79c6">(</span>mockUserMapper<span style="color:#ff79c6">).</span><span style="color:#50fa7b">registerUser</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;ciphertext&#34;</span><span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 验证一下mockUserMapper以什么方式被调用了 */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testSelectUserByUsername</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">verify</span><span style="color:#ff79c6">(</span>mockUserMapper<span style="color:#ff79c6">).</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 验证一下mockUserMapper是否收到的值是&#34;test&#34; */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testLoadUserByUsernameThrowsUsernameNotFoundException</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 当调用mockUserMapper.selectUserByUsername(&#34;test&#34;),模拟让它返回null */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">//        Mockito.when(mockUserMapper.selectUserByUsername(&#34;test&#34;)).thenReturn(null);
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>        <span style="color:#6272a4">/* 上面的实际是多余的,因为你不对它配置的时候,它默认就是返回null */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 断言一下,当执行userService.loadUserByUsername(&#34;test&#34;)的时候会抛出UsernameNotFoundException异常 */</span>
</span></span><span style="display:flex;"><span>        Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertThrows</span><span style="color:#ff79c6">(</span>UsernameNotFoundException<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">()</span> <span style="color:#ff79c6">-&gt;</span> userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testLoadUserByUsernameReturnUserDetail</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 当调用mockUserMapper.selectUserByUsername(&#34;test&#34;)模拟让它返回一个User对象 */</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">when</span><span style="color:#ff79c6">(</span>mockUserMapper<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">thenReturn</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> User<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;ciphertext&#34;</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>        UserDetails userDetails <span style="color:#ff79c6">=</span> userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 调用实际的逻辑 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 验证返回的结果是否符合预期 */</span>
</span></span><span style="display:flex;"><span>        Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertEquals</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;test&#34;</span><span style="color:#ff79c6">,</span> userDetails<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getUsername</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertEquals</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;ciphertext&#34;</span><span style="color:#ff79c6">,</span> userDetails<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getPassword</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h4 id="为springboot的controller编写测试">为Springboot的Controller编写测试</h4>
<ul>
<li>为Springboot的Controller编写测试需要引入Springboot的依赖</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;groupId&gt;</span>org.springframework.boot<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>spring-boot-starter-test<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;scope&gt;</span>test<span style="color:#ff79c6">&lt;/scope&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/dependency&gt;</span>
</span></span></code></pre></div><ul>
<li>Test</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@ExtendWith<span style="color:#ff79c6">(</span>MockitoExtension<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>@ExtendWith<span style="color:#ff79c6">(</span>SpringExtension<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">UserControllerTest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> MockMvc mockMvc<span style="color:#ff79c6">;</span> <span style="color:#6272a4">/* 测试Controller必须的,模拟各种请求 */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Mock
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> UserService userService<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>    @Mock
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> AuthenticationManager authenticationManager<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> BCryptPasswordEncoder bCryptPasswordEncoder <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> BCryptPasswordEncoder<span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/* 每次调用测试方法之前,都会执行 */</span>
</span></span><span style="display:flex;"><span>    @BeforeEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setUp</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        mockMvc <span style="color:#ff79c6">=</span> MockMvcBuilders<span style="color:#ff79c6">.</span><span style="color:#50fa7b">standaloneSetup</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> UserController<span style="color:#ff79c6">(</span>userService<span style="color:#ff79c6">,</span> authenticationManager<span style="color:#ff79c6">)).</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testAuthByDefault</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 执行一个Get请求,请求auth接口,并预期的返回的状态码是 200,并且响应中包含&#34;用户尚未登录&#34; */</span>
</span></span><span style="display:flex;"><span>        mockMvc<span style="color:#ff79c6">.</span><span style="color:#50fa7b">perform</span><span style="color:#ff79c6">(</span>MockMvcRequestBuilders<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>MockMvcResultMatchers<span style="color:#ff79c6">.</span><span style="color:#50fa7b">status</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">isOk</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>result <span style="color:#ff79c6">-&gt;</span> Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertTrue</span><span style="color:#ff79c6">(</span>result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getResponse</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getContentAsString</span><span style="color:#ff79c6">(</span>StandardCharsets<span style="color:#ff79c6">.</span><span style="color:#50fa7b">UTF_8</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户尚未登录&#34;</span><span style="color:#ff79c6">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testLogin</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> Exception <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 发送一个Get请求,请求auth接口,并预期的返回的状态码是 200,并且响应中包含&#34;用户尚未登录&#34; */</span>
</span></span><span style="display:flex;"><span>        mockMvc<span style="color:#ff79c6">.</span><span style="color:#50fa7b">perform</span><span style="color:#ff79c6">(</span>MockMvcRequestBuilders<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>MockMvcResultMatchers<span style="color:#ff79c6">.</span><span style="color:#50fa7b">status</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">isOk</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>result <span style="color:#ff79c6">-&gt;</span> Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertTrue</span><span style="color:#ff79c6">(</span>result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getResponse</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getContentAsString</span><span style="color:#ff79c6">(</span>StandardCharsets<span style="color:#ff79c6">.</span><span style="color:#50fa7b">UTF_8</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户尚未登录&#34;</span><span style="color:#ff79c6">)));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* Mock一些依赖 */</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">when</span><span style="color:#ff79c6">(</span>userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">loadUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">thenReturn</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> User<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">,</span> bCryptPasswordEncoder<span style="color:#ff79c6">.</span><span style="color:#50fa7b">encode</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">),</span> Collections<span style="color:#ff79c6">.</span><span style="color:#50fa7b">emptyList</span><span style="color:#ff79c6">()));</span>
</span></span><span style="display:flex;"><span>        Mockito<span style="color:#ff79c6">.</span><span style="color:#50fa7b">when</span><span style="color:#ff79c6">(</span>userService<span style="color:#ff79c6">.</span><span style="color:#50fa7b">selectUserByUsername</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">thenReturn</span><span style="color:#ff79c6">(</span><span style="color:#ff79c6">new</span> com<span style="color:#ff79c6">.</span><span style="color:#50fa7b">github</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">wjinlei</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">springbootblog</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">entity</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">User</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 准备post参数 */</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">,</span> String<span style="color:#ff79c6">&gt;</span> params <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HashMap<span style="color:#ff79c6">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>        params<span style="color:#ff79c6">.</span><span style="color:#50fa7b">put</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;username&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        params<span style="color:#ff79c6">.</span><span style="color:#50fa7b">put</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#34;admin123&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        String jsonValue <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ObjectMapper<span style="color:#ff79c6">().</span><span style="color:#50fa7b">writeValueAsString</span><span style="color:#ff79c6">(</span>params<span style="color:#ff79c6">);</span> <span style="color:#6272a4">/* 将Map序列化成json字符串 */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 发送一个Get请求,请求/auth/login接口,并预期返回的状态码是 200,并且拿到它的返回值 */</span>
</span></span><span style="display:flex;"><span>        MvcResult mvcResult <span style="color:#ff79c6">=</span> mockMvc<span style="color:#ff79c6">.</span><span style="color:#50fa7b">perform</span><span style="color:#ff79c6">(</span>MockMvcRequestBuilders<span style="color:#ff79c6">.</span><span style="color:#50fa7b">post</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth/login&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">contentType</span><span style="color:#ff79c6">(</span>MediaType<span style="color:#ff79c6">.</span><span style="color:#50fa7b">APPLICATION_JSON</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">.</span><span style="color:#50fa7b">content</span><span style="color:#ff79c6">(</span>jsonValue<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>MockMvcResultMatchers<span style="color:#ff79c6">.</span><span style="color:#50fa7b">status</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">isOk</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>result <span style="color:#ff79c6">-&gt;</span> Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertTrue</span><span style="color:#ff79c6">(</span>result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getResponse</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getContentAsString</span><span style="color:#ff79c6">(</span>StandardCharsets<span style="color:#ff79c6">.</span><span style="color:#50fa7b">UTF_8</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;登录成功&#34;</span><span style="color:#ff79c6">)))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andReturn</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        HttpSession session <span style="color:#ff79c6">=</span> mvcResult<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getRequest</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getSession</span><span style="color:#ff79c6">();</span> <span style="color:#6272a4">/* 从请求中获取session */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 再次发起GET /auth 请求,并断言结果中包含&#34;用户已登录&#34; */</span>
</span></span><span style="display:flex;"><span>        mockMvc<span style="color:#ff79c6">.</span><span style="color:#50fa7b">perform</span><span style="color:#ff79c6">(</span>MockMvcRequestBuilders<span style="color:#ff79c6">.</span><span style="color:#50fa7b">get</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/auth&#34;</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">session</span><span style="color:#ff79c6">((</span>MockHttpSession<span style="color:#ff79c6">)</span> session<span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>MockMvcResultMatchers<span style="color:#ff79c6">.</span><span style="color:#50fa7b">status</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">isOk</span><span style="color:#ff79c6">())</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">andExpect</span><span style="color:#ff79c6">(</span>result <span style="color:#ff79c6">-&gt;</span> Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertTrue</span><span style="color:#ff79c6">(</span>result<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getResponse</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">getContentAsString</span><span style="color:#ff79c6">(</span>StandardCharsets<span style="color:#ff79c6">.</span><span style="color:#50fa7b">UTF_8</span><span style="color:#ff79c6">).</span><span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户已登录&#34;</span><span style="color:#ff79c6">)));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><h3 id="集成测试">集成测试</h3>
<p>所谓集成测试,就是把整个项目打包,对整个项目暴露出来的外部接口进行测试,而不是对某个类,某个方法,每个单元进行测试</p>
<h4 id="在maven中如何启用集成测试">在Maven中如何启用集成测试</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- 用于单元测试 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-surefire-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 从单元测试中排除 IntegrationTest名称的测试 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;excludes&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;exclude&gt;</span>**/*IntegrationTest<span style="color:#ff79c6">&lt;/exclude&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/excludes&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">&lt;!-- 用于集成测试 --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-failsafe-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 从集成测试中包含 IntegrationTest名称的测试 --&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;includes&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;include&gt;</span>**/*IntegrationTest<span style="color:#ff79c6">&lt;/include&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/includes&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span></code></pre></div><h4 id="jenkins">Jenkins</h4>
<ul>
<li>安装Jenkins</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo docker run --name jenkins -p 8081:8080 -p 50000:50000 -v <span style="color:#f1fa8c">`</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#f1fa8c">`</span>/jenkins_data:/var/jenkins_home jenkins/jenkins
</span></span></code></pre></div><ul>
<li>Jenkins 创建一个工程构建项目
<img src="/images/code-java-day30/jenkins-create-project.gif" alt="创建工程"></li>
</ul>
<h4 id="在maven中启动一个mysql">在Maven中启动一个MySQL</h4>
<p>集成测试需要启动一个真正的环境,然后在进行整体测试<br>
例如,如果项目依赖<code>MySQL</code>,也就意味着,你在进行集成测试之前,应该先启动一个<code>MySQL</code><br>
要在Maven中启动MySQL,我们需要一个插件<code>exec-maven-plugin</code>,它可以帮助我们执行一个外部命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;plugins&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 用于单元测试 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-surefire-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!-- 从单元测试中排除 IntegrationTest名称的测试 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;excludes&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;exclude&gt;</span>**/*IntegrationTest<span style="color:#ff79c6">&lt;/exclude&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/excludes&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 用于集成测试 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;artifactId&gt;</span>maven-failsafe-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;version&gt;</span>2.22.2<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;includes&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;include&gt;</span>**/*IntegrationTest<span style="color:#ff79c6">&lt;/include&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/includes&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- 用于执行一个外部命令 --&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;groupId&gt;</span>org.codehaus.mojo<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;artifactId&gt;</span>exec-maven-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;version&gt;</span>3.0.0<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">&lt;!-- 可以有多个execution, 每一个execution,需要一个id,用以区分 --&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;id&gt;</span>start-test-database<span style="color:#ff79c6">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">&lt;!-- 绑定到哪个阶段上,Maven在运行到这个阶段的时候,会自动帮我们运行整个goal --&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;phase&gt;</span>pre-integration-test<span style="color:#ff79c6">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;goal&gt;</span>exec<span style="color:#ff79c6">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#6272a4">&lt;!-- 执行docker命令启动一个测试用MySQL--&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;executable&gt;</span>sudo<span style="color:#ff79c6">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>docker<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>run<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>--name<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>test-mysql<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-p<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>3307:3306<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-e<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>MYSQL_ROOT_PASSWORD=root<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-e<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>MYSQL_DATABASE=blog<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-d<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>mysql:8.0.27<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!-- 测试数据库启动之后,先等待20秒左右,等待数据库初始化 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;id&gt;</span>wait-test-database<span style="color:#ff79c6">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;phase&gt;</span>pre-integration-test<span style="color:#ff79c6">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;goal&gt;</span>exec<span style="color:#ff79c6">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;executable&gt;</span>ping<span style="color:#ff79c6">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-c<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>20<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>baidu.com<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">&lt;!-- 集成测试之后销毁测试数据库 --&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;id&gt;</span>rm-test-database<span style="color:#ff79c6">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;phase&gt;</span>post-integration-test<span style="color:#ff79c6">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;goal&gt;</span>exec<span style="color:#ff79c6">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;executable&gt;</span>sudo<span style="color:#ff79c6">&lt;/executable&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;arguments&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>docker<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>rm<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>-f<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&lt;argument&gt;</span>test-mysql<span style="color:#ff79c6">&lt;/argument&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;/arguments&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">&lt;!-- flyway插件也绑定到pre-integration-test阶段,并且要在exec插件之后,因为要等数据启动起来后再migrate--&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;groupId&gt;</span>org.flywaydb<span style="color:#ff79c6">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;artifactId&gt;</span>flyway-maven-plugin<span style="color:#ff79c6">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;version&gt;</span>8.0.4<span style="color:#ff79c6">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;url&gt;</span>jdbc:mysql://localhost:3306/blog?characterEncoding=utf-8<span style="color:#ff79c6">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;user&gt;</span>root<span style="color:#ff79c6">&lt;/user&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;password&gt;</span>root<span style="color:#ff79c6">&lt;/password&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;executions&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;execution&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;id&gt;</span>initialize<span style="color:#ff79c6">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;phase&gt;</span>pre-integration-test<span style="color:#ff79c6">&lt;/phase&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;goals&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;goal&gt;</span>migrate<span style="color:#ff79c6">&lt;/goal&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/goals&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">&lt;!-- 这个execution额外的配置,因为是对测试数据库执行,而不是真实的数据库,因此端口指向测试数据库的端口3307 --&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;url&gt;</span>jdbc:mysql://localhost:3307/blog?characterEncoding=utf-8<span style="color:#ff79c6">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;user&gt;</span>root<span style="color:#ff79c6">&lt;/user&gt;</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&lt;password&gt;</span>root<span style="color:#ff79c6">&lt;/password&gt;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">&lt;/execution&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&lt;/executions&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&lt;/plugin&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">&lt;/plugins&gt;</span>
</span></span></code></pre></div><h4 id="编写一个集成测试">编写一个集成测试</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@ExtendWith<span style="color:#ff79c6">(</span>SpringExtension<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 指定要测试SpringbootBlogApplication, 并指定一个随机端口,因为你不能占用正常的端口 */</span>
</span></span><span style="display:flex;"><span>@SpringBootTest<span style="color:#ff79c6">(</span>classes <span style="color:#ff79c6">=</span> SpringbootBlogApplication<span style="color:#ff79c6">.</span><span style="color:#50fa7b">class</span><span style="color:#ff79c6">,</span> webEnvironment <span style="color:#ff79c6">=</span> SpringBootTest<span style="color:#ff79c6">.</span><span style="color:#50fa7b">WebEnvironment</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">RANDOM_PORT</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 指定一个测试的配置文件,因为真实的项目配置文件连接的数据库是3306,而我们测试数据库是3307 */</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">/* 我们可以在test包中新建一个resources/test.properties配置文件并修改端口为3307 */</span>
</span></span><span style="display:flex;"><span>@TestPropertySource<span style="color:#ff79c6">(</span>locations <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;classpath:test.properties&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">AppIntegrationTest</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    @Inject
</span></span><span style="display:flex;"><span>    Environment environment<span style="color:#ff79c6">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     * 测试首页能够访问
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">     */</span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">testAuthByDefault</span><span style="color:#ff79c6">()</span> <span style="color:#8be9fd;font-style:italic">throws</span> IOException<span style="color:#ff79c6">,</span> InterruptedException <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 获得随机启动的端口号 */</span>
</span></span><span style="display:flex;"><span>        String port <span style="color:#ff79c6">=</span> environment<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getProperty</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;local.server.port&#34;</span><span style="color:#ff79c6">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 使用Java 11 自带的httpclient库发送请求 */</span>
</span></span><span style="display:flex;"><span>        HttpClient client <span style="color:#ff79c6">=</span> HttpClient<span style="color:#ff79c6">.</span><span style="color:#50fa7b">newHttpClient</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        HttpRequest request <span style="color:#ff79c6">=</span> HttpRequest<span style="color:#ff79c6">.</span><span style="color:#50fa7b">newBuilder</span><span style="color:#ff79c6">()</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">uri</span><span style="color:#ff79c6">(</span>URI<span style="color:#ff79c6">.</span><span style="color:#50fa7b">create</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;http://localhost:&#34;</span> <span style="color:#ff79c6">+</span> port <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/auth&#34;</span><span style="color:#ff79c6">))</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">.</span><span style="color:#50fa7b">build</span><span style="color:#ff79c6">();</span>
</span></span><span style="display:flex;"><span>        HttpResponse<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> response <span style="color:#ff79c6">=</span> client<span style="color:#ff79c6">.</span><span style="color:#50fa7b">send</span><span style="color:#ff79c6">(</span>request<span style="color:#ff79c6">,</span> HttpResponse<span style="color:#ff79c6">.</span><span style="color:#50fa7b">BodyHandlers</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ofString</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertEquals</span><span style="color:#ff79c6">(</span>200<span style="color:#ff79c6">,</span> response<span style="color:#ff79c6">.</span><span style="color:#50fa7b">statusCode</span><span style="color:#ff79c6">());</span>
</span></span><span style="display:flex;"><span>        Assertions<span style="color:#ff79c6">.</span><span style="color:#50fa7b">assertTrue</span><span style="color:#ff79c6">(</span>response<span style="color:#ff79c6">.</span><span style="color:#50fa7b">body</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">contains</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;用户尚未登录&#34;</span><span style="color:#ff79c6">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div>

<script src="https://utteranc.es/client.js"
        repo="Wjinlei/wjinlei.github.io"
        issue-term="title"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</div>
</div><p class="footer text-center color-999">标签列表</p>

  <a class="footer" href="http://wjinlei.github.io/tags/ccna/">ccna</a>

  <a class="footer" href="http://wjinlei.github.io/tags/compression/">compression</a>

  <a class="footer" href="http://wjinlei.github.io/tags/docker/">docker</a>

  <a class="footer" href="http://wjinlei.github.io/tags/golang/">golang</a>

  <a class="footer" href="http://wjinlei.github.io/tags/hugo/">hugo</a>

  <a class="footer" href="http://wjinlei.github.io/tags/java/">java</a>

  <a class="footer" href="http://wjinlei.github.io/tags/linux/">Linux</a>

  <a class="footer" href="http://wjinlei.github.io/tags/mame/">MAME</a>

  <a class="footer" href="http://wjinlei.github.io/tags/maven/">Maven</a>

  <a class="footer" href="http://wjinlei.github.io/tags/mybatis/">MyBatis</a>

  <a class="footer" href="http://wjinlei.github.io/tags/pyenv/">pyenv</a>

  <a class="footer" href="http://wjinlei.github.io/tags/raylib/">raylib</a>

  <a class="footer" href="http://wjinlei.github.io/tags/rust/">rust</a>

  <a class="footer" href="http://wjinlei.github.io/tags/spring/">Spring</a>

  <a class="footer" href="http://wjinlei.github.io/tags/springboot/">Springboot</a>

  <a class="footer" href="http://wjinlei.github.io/tags/sql/">Sql</a>

  <a class="footer" href="http://wjinlei.github.io/tags/steam/">Steam</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%8B%B3%E7%9A%8797/">拳皇97</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%A8%A1%E6%8B%9F%E5%99%A8/">模拟器</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%B8%B8%E6%88%8F/">游戏</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E/">游戏引擎</a>

  <a class="footer" href="http://wjinlei.github.io/tags/%E7%AE%97%E6%B3%95/">算法</a>


<p class="footer text-center color-999">&copy; 2022 <a href="https://github.com/Wjinlei">Jerry Wang</a></p>
<p class="footer text-center color-999">由 <a href="https://gohugo.io">Hugo</a> 强力驱动</p>
<script src="/js/fuse.min.js"></script>
<script src="/js/fastsearch.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script>
  let randomPostList = document.getElementById("random-post-list");
  if (randomPostList !== null) {
    fetchJSONFile("/index.json", function (data) {
      var options = {
        
        minMatchCharLength: 2,
        shouldSort: true,
        ignoreLocation: true,
        threshold: 0.0,
        keys: ["title"]
      };
      
      fuseIndex = Fuse.createIndex(options.keys, data);
      fuse = new Fuse(data, options, fuseIndex); 

      let permalinks = [];
      let html = "";
      for (var i = 0; i < 50; i++) {
        var index = Math.floor(Math.random() * fuse._docs.length);
        if (index >= fuse._docs.length) {
          break;
        }

        if (permalinks.includes(fuse._docs[index].permalink)) {
          continue;
        }

        html = html + '<li><a href="' + fuse._docs[index].permalink + '">' + '<span class="title">' + fuse._docs[index].title + "</span></a></li>";
        permalinks.push(fuse._docs[index].permalink);
        fuse.removeAt(index);
      }
      randomPostList.innerHTML = html;
    });
  }
</script>
</body>
</html>
